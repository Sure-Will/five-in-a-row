<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº”å­æ£‹æ¸¸æˆ - Gomoku</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 30px;
            max-width: 800px;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 20px;
            font-size: 1.1em;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 10px;
        }

        .current-player {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
        }

        .player-black {
            color: #000;
        }

        .player-white {
            color: #666;
        }

        .controls {
            display: flex;
            gap: 10px;
        }

        button {
            padding: 10px 20px;
            font-size: 1em;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .btn-undo {
            background: #ff9800;
            color: white;
        }

        .btn-undo:hover {
            background: #f57c00;
        }

        .btn-restart {
            background: #4caf50;
            color: white;
        }

        .btn-restart:hover {
            background: #45a049;
        }

        .btn-size {
            background: #2196f3;
            color: white;
        }

        .btn-size:hover {
            background: #0b7dda;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .board-container {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }

        #gameBoard {
            background: #daa520;
            border: 3px solid #8b6914;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            cursor: pointer;
        }

        .winner-message {
            text-align: center;
            font-size: 1.5em;
            font-weight: bold;
            color: #4caf50;
            margin: 20px 0;
            padding: 15px;
            background: #e8f5e9;
            border-radius: 10px;
            display: none;
        }

        .winner-message.show {
            display: block;
            animation: slideDown 0.5s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .instructions {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .instructions h3 {
            color: #1976d2;
            margin-bottom: 10px;
        }

        .instructions ul {
            list-style-position: inside;
            color: #333;
            line-height: 1.8;
        }

        @media (max-width: 600px) {
            .container {
                padding: 15px;
            }

            h1 {
                font-size: 1.8em;
            }

            .game-info {
                flex-direction: column;
                gap: 10px;
            }

            .controls {
                flex-wrap: wrap;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ® äº”å­æ£‹</h1>
        <p class="subtitle">Gomoku / Five in a Row</p>

        <div class="game-info">
            <div class="current-player" id="currentPlayer">
                å½“å‰ç©å®¶ï¼š<span class="player-black">â— é»‘æ£‹</span>
            </div>
            <div class="controls">
                <button class="btn-undo" id="undoBtn" onclick="undoMove()">â†©ï¸ æ‚”æ£‹</button>
                <button class="btn-restart" id="restartBtn" onclick="restartGame()">ğŸ”„ é‡æ–°å¼€å§‹</button>
                <button class="btn-size" id="sizeBtn" onclick="changeBoardSize()">ğŸ“ æ”¹å˜æ£‹ç›˜</button>
            </div>
        </div>

        <div class="winner-message" id="winnerMessage"></div>

        <div class="board-container">
            <canvas id="gameBoard"></canvas>
        </div>

        <div class="instructions">
            <h3>ğŸ“– æ¸¸æˆè§„åˆ™</h3>
            <ul>
                <li>é»‘æ£‹å…ˆè¡Œï¼Œç™½æ£‹åè¡Œ</li>
                <li>ç‚¹å‡»æ£‹ç›˜ç©ºç™½å¤„è½å­</li>
                <li>å…ˆå°†äº”ä¸ªæ£‹å­è¿æˆä¸€çº¿è€…è·èƒœï¼ˆæ¨ªã€ç«–ã€æ–œå‡å¯ï¼‰</li>
                <li>å¯ä»¥ä½¿ç”¨æ‚”æ£‹åŠŸèƒ½æ’¤é”€ä¸Šä¸€æ­¥</li>
            </ul>
        </div>
    </div>

    <script>
        class GomokuGame {
            constructor(boardSize = 15) {
                this.boardSize = boardSize;
                this.cellSize = Math.min(500 / boardSize, 40);
                this.board = Array(boardSize).fill(null).map(() => Array(boardSize).fill(0));
                this.currentPlayer = 1; // 1 = é»‘æ£‹, 2 = ç™½æ£‹
                this.gameOver = false;
                this.winner = null;
                this.moveHistory = [];

                this.canvas = document.getElementById('gameBoard');
                this.ctx = this.canvas.getContext('2d');

                this.initCanvas();
                this.drawBoard();
                this.setupEventListeners();
            }

            initCanvas() {
                const size = this.cellSize * (this.boardSize + 1);
                this.canvas.width = size;
                this.canvas.height = size;
            }

            drawBoard() {
                const ctx = this.ctx;
                const cellSize = this.cellSize;
                const boardSize = this.boardSize;

                // æ¸…ç©ºç”»å¸ƒ
                ctx.fillStyle = '#daa520';
                ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);

                // ç»˜åˆ¶ç½‘æ ¼çº¿
                ctx.strokeStyle = '#000';
                ctx.lineWidth = 1;

                for (let i = 0; i < boardSize; i++) {
                    // æ¨ªçº¿
                    ctx.beginPath();
                    ctx.moveTo(cellSize, cellSize * (i + 1));
                    ctx.lineTo(cellSize * boardSize, cellSize * (i + 1));
                    ctx.stroke();

                    // ç«–çº¿
                    ctx.beginPath();
                    ctx.moveTo(cellSize * (i + 1), cellSize);
                    ctx.lineTo(cellSize * (i + 1), cellSize * boardSize);
                    ctx.stroke();
                }

                // ç»˜åˆ¶å¤©å…ƒå’Œæ˜Ÿä½
                const drawDot = (x, y) => {
                    ctx.beginPath();
                    ctx.arc(cellSize * (x + 1), cellSize * (y + 1), 4, 0, Math.PI * 2);
                    ctx.fillStyle = '#000';
                    ctx.fill();
                };

                if (boardSize === 15) {
                    // æ ‡å‡†15è·¯æ£‹ç›˜çš„æ˜Ÿä½
                    drawDot(3, 3);
                    drawDot(11, 3);
                    drawDot(3, 11);
                    drawDot(11, 11);
                    drawDot(7, 7); // å¤©å…ƒ
                }

                // ç»˜åˆ¶æ£‹å­
                for (let i = 0; i < boardSize; i++) {
                    for (let j = 0; j < boardSize; j++) {
                        if (this.board[i][j] !== 0) {
                            this.drawPiece(i, j, this.board[i][j]);
                        }
                    }
                }
            }

            drawPiece(row, col, player) {
                const ctx = this.ctx;
                const x = this.cellSize * (col + 1);
                const y = this.cellSize * (row + 1);
                const radius = this.cellSize * 0.4;

                // ç»˜åˆ¶é˜´å½±
                ctx.beginPath();
                ctx.arc(x + 2, y + 2, radius, 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';
                ctx.fill();

                // ç»˜åˆ¶æ£‹å­
                ctx.beginPath();
                ctx.arc(x, y, radius, 0, Math.PI * 2);

                if (player === 1) {
                    // é»‘æ£‹
                    const gradient = ctx.createRadialGradient(x - radius/3, y - radius/3, 0, x, y, radius);
                    gradient.addColorStop(0, '#666');
                    gradient.addColorStop(1, '#000');
                    ctx.fillStyle = gradient;
                } else {
                    // ç™½æ£‹
                    const gradient = ctx.createRadialGradient(x - radius/3, y - radius/3, 0, x, y, radius);
                    gradient.addColorStop(0, '#fff');
                    gradient.addColorStop(1, '#ddd');
                    ctx.fillStyle = gradient;
                }

                ctx.fill();
                ctx.strokeStyle = '#000';
                ctx.lineWidth = 1;
                ctx.stroke();
            }

            setupEventListeners() {
                this.canvas.addEventListener('click', (e) => {
                    if (this.gameOver) return;

                    const rect = this.canvas.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;

                    const col = Math.round(x / this.cellSize) - 1;
                    const row = Math.round(y / this.cellSize) - 1;

                    if (this.isValidMove(row, col)) {
                        this.makeMove(row, col);
                    }
                });
            }

            isValidMove(row, col) {
                if (row < 0 || row >= this.boardSize || col < 0 || col >= this.boardSize) {
                    return false;
                }
                return this.board[row][col] === 0;
            }

            makeMove(row, col) {
                this.board[row][col] = this.currentPlayer;
                this.moveHistory.push({ row, col, player: this.currentPlayer });
                this.drawBoard();

                if (this.checkWin(row, col)) {
                    this.gameOver = true;
                    this.winner = this.currentPlayer;
                    this.showWinner();
                } else if (this.isBoardFull()) {
                    this.gameOver = true;
                    this.showDraw();
                } else {
                    this.currentPlayer = this.currentPlayer === 1 ? 2 : 1;
                    this.updateCurrentPlayer();
                }

                document.getElementById('undoBtn').disabled = false;
            }

            checkWin(row, col) {
                const directions = [
                    [0, 1],   // æ¨ªå‘
                    [1, 0],   // çºµå‘
                    [1, 1],   // å³ä¸‹æ–œ
                    [1, -1]   // å·¦ä¸‹æ–œ
                ];

                const player = this.board[row][col];

                for (let [dr, dc] of directions) {
                    let count = 1;

                    // æ­£æ–¹å‘
                    let r = row + dr, c = col + dc;
                    while (r >= 0 && r < this.boardSize && c >= 0 && c < this.boardSize &&
                           this.board[r][c] === player) {
                        count++;
                        r += dr;
                        c += dc;
                    }

                    // åæ–¹å‘
                    r = row - dr;
                    c = col - dc;
                    while (r >= 0 && r < this.boardSize && c >= 0 && c < this.boardSize &&
                           this.board[r][c] === player) {
                        count++;
                        r -= dr;
                        c -= dc;
                    }

                    if (count >= 5) {
                        return true;
                    }
                }

                return false;
            }

            isBoardFull() {
                for (let row of this.board) {
                    if (row.includes(0)) {
                        return false;
                    }
                }
                return true;
            }

            updateCurrentPlayer() {
                const playerText = this.currentPlayer === 1
                    ? '<span class="player-black">â— é»‘æ£‹</span>'
                    : '<span class="player-white">â—‹ ç™½æ£‹</span>';
                document.getElementById('currentPlayer').innerHTML = 'å½“å‰ç©å®¶ï¼š' + playerText;
            }

            showWinner() {
                const playerName = this.winner === 1 ? 'é»‘æ£‹' : 'ç™½æ£‹';
                const message = document.getElementById('winnerMessage');
                message.innerHTML = `ğŸ‰ æ­å–œï¼${playerName} è·èƒœï¼`;
                message.className = 'winner-message show';
                message.style.color = this.winner === 1 ? '#000' : '#666';
            }

            showDraw() {
                const message = document.getElementById('winnerMessage');
                message.innerHTML = 'ğŸ¤ å¹³å±€ï¼æ£‹ç›˜å·²æ»¡';
                message.className = 'winner-message show';
                message.style.color = '#ff9800';
            }

            undo() {
                if (this.moveHistory.length === 0) {
                    return false;
                }

                const lastMove = this.moveHistory.pop();
                this.board[lastMove.row][lastMove.col] = 0;
                this.currentPlayer = lastMove.player;
                this.gameOver = false;
                this.winner = null;

                document.getElementById('winnerMessage').className = 'winner-message';
                this.drawBoard();
                this.updateCurrentPlayer();

                if (this.moveHistory.length === 0) {
                    document.getElementById('undoBtn').disabled = true;
                }

                return true;
            }

            reset() {
                this.board = Array(this.boardSize).fill(null).map(() => Array(this.boardSize).fill(0));
                this.currentPlayer = 1;
                this.gameOver = false;
                this.winner = null;
                this.moveHistory = [];

                document.getElementById('winnerMessage').className = 'winner-message';
                document.getElementById('undoBtn').disabled = true;
                this.drawBoard();
                this.updateCurrentPlayer();
            }
        }

        // å…¨å±€æ¸¸æˆå®ä¾‹
        let game = new GomokuGame(15);

        function undoMove() {
            game.undo();
        }

        function restartGame() {
            if (confirm('ç¡®å®šè¦é‡æ–°å¼€å§‹æ¸¸æˆå—ï¼Ÿ')) {
                game.reset();
            }
        }

        function changeBoardSize() {
            const sizes = [9, 13, 15, 19];
            const sizeNames = ['9è·¯ï¼ˆå¿«é€Ÿï¼‰', '13è·¯ï¼ˆä¸­ç­‰ï¼‰', '15è·¯ï¼ˆæ ‡å‡†ï¼‰', '19è·¯ï¼ˆå›´æ£‹ï¼‰'];

            let message = 'é€‰æ‹©æ£‹ç›˜å¤§å°ï¼š\n';
            sizes.forEach((size, index) => {
                message += `${index + 1}. ${sizeNames[index]}\n`;
            });

            const choice = prompt(message + '\nè¯·è¾“å…¥åºå·ï¼ˆ1-4ï¼‰ï¼š');
            const index = parseInt(choice) - 1;

            if (index >= 0 && index < sizes.length) {
                game = new GomokuGame(sizes[index]);
                document.getElementById('undoBtn').disabled = true;
            }
        }

        // åˆå§‹åŒ–
        document.getElementById('undoBtn').disabled = true;
    </script>
</body>
</html>
